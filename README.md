# README.md

## 1. Описание проекта (Jupyter Notebook)

### Общая информация
Данный проект реализует систему прогнозирования риска сердечного приступа на основе медицинских данных пациентов. Проект выполнен в рамках задания М1 и включает полный цикл работы с данными: от первоначального анализа до создания готового API для предсказаний.

### Структура ноутбука
Ноутбук разделен на 5 ключевых этапов:

#### Этап 1: Исследование и загрузка данных
- Загрузка обучающего (`heart_train.csv`) и тестового (`heart_test.csv`) датасетов
- Анализ структуры данных: количество строк, столбцов, типы данных
- Исследование распределения целевой переменной (баланс классов)
- Основные статистики числовых признаков
- Обнаружение особенностей данных (столбец с полом в формате 'Male'/'Female')

#### Этап 2: Предварительный осмотр и анализ
- Поиск пропущенных значений и дубликатов
- Анализ уникальных значений в каждом признаке
- Визуализация распределений ключевых признаков
- Корреляционный анализ числовых признаков
- Обнаружение выбросов и признаков с утечкой целевой переменной
- Графическое представление зависимостей между признаками

#### Этап 3: Предобработка данных
- Удаление дубликатов
- Кодирование категориальных признаков (пол: 'Male' -> 0, 'Female' -> 1)
- Масштабирование числовых признаков (StandardScaler)
- Формирование финальных наборов признаков для обучения
- Сохранение предпроцессора для последующего использования

#### Этап 4: Обучение моделей
- Разделение данных на обучающую и валидационную выборки
- Обучение модели CatBoostClassifier с настройкой гиперпараметров
- Стратифицированная кросс-валидация (5 фолдов)
- Оценка качества модели с использованием метрики ROC AUC
- Анализ важности признаков
- Оптимизация порога классификации для минимизации False Negative

### Используемые инструменты и библиотеки
- **Pandas, NumPy** — для работы с данными
- **Matplotlib, Seaborn** — для визуализации
- **Scikit-learn** — для предобработки данных и метрик оценки
- **CatBoost** — для построения модели машинного обучения
- **FastAPI** — для создания API сервиса
- **Joblib** — для сохранения артефактов (модели и предпроцессора)

### Качество модели
На валидационной выборке модель показала:
- ROC AUC: 0.9473
- Accuracy: 0.8789
- F1-score: 0.9034

При кросс-валидации среднее значение ROC AUC составило 0.5703 ± 0.0101

## 2. Описание работы main.py

### Назначение
`main.py` реализует FastAPI приложение для прогнозирования риска сердечного приступа. Приложение обеспечивает:
- Прием CSV файлов с медицинскими данными пациентов
- Автоматическую предобработку данных
- Генерацию предсказаний с использованием предобученной модели CatBoost
- Возврат результатов в формате JSON или CSV
- Предоставление информативного веб-интерфейса с документацией

### Структура приложения

#### Инициализация и загрузка артефактов
- Автоматический поиск и загрузка файлов модели (`catboost_model.cbm`) и предпроцессора (`preprocessor.pkl`) в различных директориях
- Обработка ошибок при загрузке артефактов с подробным логированием
- Проверка готовности сервиса к работе

#### Эндпоинты API

1. **POST /predict**
   - Принимает CSV файл с данными пациентов
   - Параметр `return_csv` (опционально) позволяет получить результат в формате CSV
   - Автоматическое определение кодировки файла
   - Обработка файлов без заголовков (первый столбец считается ID)
   - Предобработка данных с использованием сохраненного предпроцессора
   - Генерация предсказаний
   - Возврат результата в формате JSON с полями `id`, `prediction` и `probability` или CSV файла

2. **GET /**
   - Главная страница с информацией о сервисе
   - Отображение текущего статуса сервиса (загружены ли модель и предпроцессор)
   - Кликабельные ссылки на документацию и другие эндпоинты
   - Инструкция по использованию API

3. **GET /health**
   - Проверка состояния сервиса
   - Информация о загруженных компонентах
   - Статус готовности к обработке запросов

4. **GET /model-info**
   - Получение информации о модели
   - Важность признаков
   - Параметры обучения
   - Метрика оценки качества

#### Классы в стиле ООП
- `DataPreprocessor` — инкапсулирует логику предобработки данных
- `HeartAttackPredictor` — управляет загрузкой модели, предобработкой данных и генерацией предсказаний

#### Особенности реализации
- **Надежная обработка ошибок** с информативными сообщениями
- **Автоматическое определение кодировки** файла с использованием библиотеки chardet
- **Поддержка файлов без заголовков** — первый столбец автоматически распознается как ID пациента
- **Обработка строковых значений** (Male/Female) в данных
- **Детальное логирование** для отладки и мониторинга
- **Информативный HTML-интерфейс** с инструкциями по использованию

### Запуск приложения


После запуска сервис будет доступен по адресу:
http://localhost:8000/docs

### Требования к окружению
- Python 3.9+
- FastAPI, Uvicorn
- Pandas, NumPy
- Scikit-learn, CatBoost
- Joblib, python-multipart
- Chardet (для определения кодировки файлов)


Файл `predictions.csv` будет содержать два столбца: `id` и `prediction` в соответствии с требованиями ТЗ.